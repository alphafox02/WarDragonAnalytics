# WarDragon Analytics Environment Configuration
# Copy this file to .env and update with your actual values
# NEVER commit .env to version control!

# =============================================================================
# Database Configuration
# =============================================================================
# PostgreSQL/TimescaleDB password
# SECURITY: Use a strong password (min 20 characters, alphanumeric + special chars)
DB_PASSWORD=CHANGEME_STRONG_PASSWORD_HERE

# =============================================================================
# Grafana Configuration
# =============================================================================
# Grafana admin username
GRAFANA_USER=admin

# Grafana admin password
# SECURITY: Use a strong password (min 20 characters, alphanumeric + special chars)
GRAFANA_PASSWORD=CHANGEME_GRAFANA_PASSWORD_HERE

# Grafana secret key for signing cookies
# SECURITY: Generate with: openssl rand -base64 32
GRAFANA_SECRET_KEY=CHANGEME_GRAFANA_SECRET_KEY_HERE

# Grafana root URL (for reverse proxy support)
GRAFANA_ROOT_URL=http://localhost:3000

# Grafana port (default: 3000)
GRAFANA_PORT=3000

# Grafana log level (debug, info, warn, error)
GRAFANA_LOG_LEVEL=info

# =============================================================================
# Web API Configuration
# =============================================================================
# Web UI port (default: 8090)
# NOTE: 8080 is used by dump1090/readsb on WarDragon kits for ADS-B
WEB_PORT=8090

# CORS origins (comma-separated, use * for all origins in dev only)
# SECURITY: In production, specify exact origins: http://example.com,https://example.com
CORS_ORIGINS=*

# Maximum query range in hours (prevents excessive queries)
MAX_QUERY_RANGE_HOURS=168

# =============================================================================
# Collector Configuration
# =============================================================================
# Log level (DEBUG, INFO, WARNING, ERROR, CRITICAL)
LOG_LEVEL=INFO

# Polling intervals (in seconds)
POLL_INTERVAL_DRONES=5
POLL_INTERVAL_STATUS=30

# Retry configuration for failed API calls
MAX_RETRIES=3
RETRY_BACKOFF_FACTOR=2

# =============================================================================
# Volume Configuration
# =============================================================================
# Path to store persistent volumes (default: ./volumes)
# Can be absolute path for production deployment
VOLUMES_PATH=./volumes

# =============================================================================
# AI Assistant / LLM Configuration (Optional)
# =============================================================================
# The AI Assistant uses Ollama to provide natural language queries over your data.
# You need to run Ollama separately - see docs/ollama-setup.md for instructions.

# Ollama API URL (default: http://localhost:11434)
# If running Ollama on another machine, use its IP address
OLLAMA_URL=http://localhost:11434

# Ollama model to use for queries
# Recommended models (in order of capability):
#   - llama3.1:8b   (fastest, good for most queries, ~4GB VRAM)
#   - llama3.1:70b  (best quality, needs ~40GB VRAM)
#   - mistral:7b    (fast alternative, ~4GB VRAM)
#   - codellama:13b (good for technical queries, ~8GB VRAM)
OLLAMA_MODEL=llama3.1:8b

# Request timeout in seconds (increase for slower hardware)
OLLAMA_TIMEOUT=60

# Maximum tokens for response (higher = longer responses but slower)
OLLAMA_MAX_TOKENS=2048

# Temperature for response generation (0.0 = deterministic, 1.0 = creative)
# Lower values (0.1-0.3) recommended for data queries
OLLAMA_TEMPERATURE=0.1

# =============================================================================
# Web UI Authentication (Optional)
# =============================================================================
# Enable optional password protection for the web UI
# Set AUTH_ENABLED=true and AUTH_PASSWORD to require login
# Default: Disabled (no login required)

# Enable authentication (default: false)
AUTH_ENABLED=false

# Admin username for web UI login
AUTH_USERNAME=admin

# Admin password (REQUIRED if AUTH_ENABLED=true)
# SECURITY: Use a strong password (min 16 characters)
# AUTH_PASSWORD=YOUR_STRONG_PASSWORD_HERE

# JWT token expiration in hours (default: 24)
JWT_EXPIRATION_HOURS=24

# JWT secret key (auto-generated if not set)
# SECURITY: Generate with: openssl rand -base64 32
# JWT_SECRET_KEY=YOUR_SECRET_KEY_HERE

# Secure cookies (set to true if using HTTPS)
COOKIE_SECURE=false

# =============================================================================
# Alerting and Notifications (Optional)
# =============================================================================
# Enable webhook-based alerting for drone detections, security events, etc.
# Supports Slack, Discord, and generic HTTP webhooks.
# Default: Disabled

# Enable alerting (default: false)
ALERTING_ENABLED=false

# Slack webhook URL (get from Slack app settings)
# SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/WEBHOOK/URL

# Discord webhook URL (get from Discord channel settings)
# DISCORD_WEBHOOK_URL=https://discord.com/api/webhooks/YOUR/WEBHOOK/URL

# Generic HTTP POST webhook URL
# GENERIC_WEBHOOK_URL=https://your-server.com/webhook

# Custom headers for generic webhook (JSON string)
# GENERIC_WEBHOOK_HEADERS={"Authorization": "Bearer your-token"}

# Alert cooldown in seconds (prevents spam, default: 60)
ALERT_COOLDOWN_SECONDS=60

# =============================================================================
# Audit Logging (Optional)
# =============================================================================
# Audit logging tracks administrative actions for security compliance.
# Always logs to application log file; optionally logs to database.

# Audit log level (DEBUG, INFO, WARNING, ERROR)
AUDIT_LOG_LEVEL=INFO

# Store audit logs in database (in addition to log file)
# Requires running the audit table migration
AUDIT_TO_DATABASE=false

# =============================================================================
# Automated Backups (Optional)
# =============================================================================
# The backup.sh script can be run manually or scheduled via cron.
# Backups are stored in ./backups/ with 7-day retention.
#
# To schedule daily backups at 2 AM:
#   crontab -e
#   0 2 * * * /path/to/WarDragonAnalytics/scripts/backup.sh
#
# For custom backup location:
#   ./scripts/backup.sh /mnt/external/backups

# =============================================================================
# MQTT Ingest (Optional)
# =============================================================================
# Enable MQTT-based data ingest from WarDragon kits.
# This is an ALTERNATIVE to HTTP polling - kits push data directly via MQTT.
#
# Benefits:
#   - Real-time data (no polling delay)
#   - Kits auto-register when they first publish (no manual config)
#   - Better for firewalled/NAT environments (outbound connections only)
#
# Architecture:
#   WarDragon Kit (DragonSync) --> MQTT Broker (Mosquitto) --> MQTT Ingest --> TimescaleDB
#
# To use:
#   1. Set MQTT_INGEST_ENABLED=true below
#   2. Run: docker compose up -d
#   3. Configure DragonSync on each kit to publish to this server's IP:1883
#
# Default: Disabled (use HTTP polling instead)

# Enable MQTT ingest service (default: false)
MQTT_INGEST_ENABLED=false

# MQTT Broker settings (Mosquitto)
# Port to expose for external MQTT connections
MQTT_BROKER_PORT=1883

# Enable MQTT authentication (recommended for production)
# When enabled, kits must authenticate to publish
MQTT_AUTH_ENABLED=false

# MQTT username (required if MQTT_AUTH_ENABLED=true)
MQTT_USERNAME=wardragon

# MQTT password (required if MQTT_AUTH_ENABLED=true)
# SECURITY: Use a strong password if authentication is enabled
# MQTT_PASSWORD=YOUR_MQTT_PASSWORD_HERE

# Enable TLS for MQTT connections
# Requires providing certificates - see docs/mqtt-ingest.md
MQTT_TLS_ENABLED=false

# MQTT topic configuration (matches DragonSync defaults)
# Change only if you've customized DragonSync MQTT topics
MQTT_TOPIC_DRONES=wardragon/drones
MQTT_TOPIC_DRONE_PREFIX=wardragon/drone/
MQTT_TOPIC_AIRCRAFT=wardragon/aircraft
MQTT_TOPIC_SIGNALS=wardragon/signals
MQTT_TOPIC_SYSTEM=wardragon/system

# =============================================================================
# Production Deployment Notes
# =============================================================================
# 1. Generate strong passwords:
#    openssl rand -base64 32
#
# 2. Create volumes directory:
#    mkdir -p ./volumes/timescale-data ./volumes/grafana-data
#    chmod 700 ./volumes/timescale-data ./volumes/grafana-data
#
# 3. For production, bind to localhost only (already done in docker-compose.yml):
#    - TimescaleDB: 127.0.0.1:5432:5432
#    - Use reverse proxy (nginx/traefik) for web/grafana with SSL
#
# 4. Enable UFW/firewall:
#    sudo ufw allow 8090/tcp  # Web UI (or via reverse proxy)
#    sudo ufw allow 3000/tcp  # Grafana (or via reverse proxy)
#
# 5. Regular backups:
#    docker exec wardragon-timescaledb pg_dump -U wardragon wardragon > backup.sql
#
# 6. Monitor logs:
#    docker-compose logs -f collector
#    docker-compose logs -f web
#
# 7. Update CORS_ORIGINS for production with specific domains
#
# 8. Consider setting up log rotation for application logs
