# Mosquitto MQTT Broker Configuration for WarDragon Analytics
# This configuration allows WarDragon kits to push data via MQTT.

# =============================================================================
# Listener Configuration
# =============================================================================
# Listen on all interfaces to accept connections from external kits
listener 1883 0.0.0.0

# Protocol to use
protocol mqtt

# =============================================================================
# Security Configuration
# =============================================================================
# Allow anonymous connections (for easy setup)
# In production, set allow_anonymous false and configure authentication
allow_anonymous true

# Password file for authentication (uncomment to enable)
# Generate with: mosquitto_passwd -c /mosquitto/config/passwd wardragon
# password_file /mosquitto/config/passwd

# =============================================================================
# Persistence Configuration
# =============================================================================
# Enable message persistence
persistence true
persistence_location /mosquitto/data/

# Autosave interval in seconds
autosave_interval 300

# =============================================================================
# Logging Configuration
# =============================================================================
# Log to stdout for Docker
log_dest stdout

# Log types to include
log_type error
log_type warning
log_type notice
log_type information

# Log timestamp format
log_timestamp true
log_timestamp_format %Y-%m-%dT%H:%M:%S

# Connection messages
connection_messages true

# =============================================================================
# Performance Tuning
# =============================================================================
# Maximum inflight messages (QoS 1 and 2)
max_inflight_messages 100

# Maximum queued messages
max_queued_messages 1000

# Message size limit (10MB should be plenty for drone data)
message_size_limit 10485760

# =============================================================================
# TLS/SSL Configuration (Optional)
# =============================================================================
# Enable encrypted MQTT connections on port 8883.
# To use TLS:
#   1. Generate certificates: ./scripts/generate-mqtt-certs.sh
#   2. Set MQTT_TLS_ENABLED=true in .env
#   3. Restart: docker compose --profile mqtt restart mosquitto
#
# For self-signed certs (testing):
#   Uncomment lines below and configure DragonSync with mqtt_tls=true
#
# For production with CA-signed certs:
#   Replace the certificate paths with your CA-signed certificates

# TLS listener on port 8883
# listener 8883 0.0.0.0
# protocol mqtt

# Certificate paths (mounted from ./mosquitto/certs/)
# cafile /mosquitto/certs/ca.crt
# certfile /mosquitto/certs/server.crt
# keyfile /mosquitto/certs/server.key

# TLS version (require TLS 1.2 or higher)
# tls_version tlsv1.2

# Don't require client certificates (one-way TLS)
# require_certificate false

# =============================================================================
# WebSocket Support (Optional)
# =============================================================================
# Uncomment to enable WebSocket listener on port 9001
# listener 9001
# protocol websockets
